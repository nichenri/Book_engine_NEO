<h2> 詳細情報 </h2>

<p><%= link_to "図書検索画面へ戻る", users_top_index_path %></p>
<br>


<% if @user_bookmark %>
  <%= link_to "ブックマークの取り消し", users_book_bookmark_path(@user_bookmark.book_id, @user_bookmark.id), method: :delete, data: {confirm: "Are you sure?"} %><br>
<% else %>
  <%= form_for @bookmark, url: users_book_bookmarks_path(@book.id) do |f| %>
  <%= f.submit :ブックマークに入れる %>
    <br>
  <% end %>
<% end %>


<table rules="all" border="3">
  <tr>
    <td>タイトル</td>
    <td><strong><%= @book.title %></strong></td>
  </tr>

  <tr>
    <td>著者</td>
    <td><%= @book.author.author_name %></td>
  </tr>

  <tr>
    <td>出版社</td>
    <td><%= @book.publisher.publisher_name %></td>
  </tr>

  <tr>
    <td>分野</td>
    <td><%= @book.genre.genre_name %></td>
  </tr>

  <tr>
    <td>図書館保有状況</td>
    <td>合計保有数: <%= @stocks.count %><br>
      <ul>
        <% @stocks.each do |stock| %>
          <li>
            <%= sprintf("%08d", stock.id) %>
            <%= status(stock) %>
          <% end %>
          <br>

          <% if @user_borrowed_stock_ids.present? %>
            返却期限:
          <% else %>
            <% if @user_reserved_stock_ids.present? %>
              取り置き有効期限:<%= @user_stock_reservation.invalid_at.to_date%>
            <% else %>
              <% if @user_book_reservation.present? %>
                <%= link_to "予約取り消し", users_book_book_reservation_path(@book.id), method: :delete, data: {confirm: "Are you sure??"} %>
              <% else %>
                <%= @not_stocked_stock_ids %>
                <% if @not_stocked_stock_ids %>
                  <%= form_for @book_reservation, url: users_book_book_reservations_path(@book.id) do |f| %>
                    <%= f.submit :この本を予約する %>
                  <% end %>
                <% else %>
                  よやく！
                <% end %>
              <% end %>
            <% end %>
          <% end %>
        </li>
      </ul>
    </td>
  </tr>
</table>


<h3>この本に対するレビュー一覧</h3>
<ul>
  <% @reviews.each do |review| %>
    <li>
      <%= review.user.name %> |
      <%= review.updated_at %> 
      <% if review.user_id == @user.id %>
        <%= link_to "編集", edit_users_book_review_path(review.book_id, review.id) %>
        <%= link_to "削除", users_book_review_path(review.book_id, review.id), method: :delete, data: {confirm: "Are you sure?"} %>
      <% end %><br>
      <%= review.content %>
    </li>
    <% end %>

    <li>
      <%= form_for @review, url: users_book_reviews_path(@book.id) do |f| %>
    <p>
    <%= f.text_field :content %>
    </p>
    <p>
    <%= f.submit :レビューの投稿 %>
    </p>
    <% end %>
</ul>
