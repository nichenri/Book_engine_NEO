def books_show(func_stocks, func_book, func_book_reservation, func_stock_reservation)

<% user_borrowing_count = 0 %>
<% user_stock_reservation_count = 0 %>
<% user_book_reservation_count = 0 %>
<% stock_count = 0 %>
<% empty_stock = 0 %>
<% funcs_stocks.each do |stock| %>
  <% if stock.borrowing_user == current_user %>
    <% user_borrowing_count += 1 %>
    <% empty_stock = stock %>
    <% break %>
    <% else if stock.reservation_user == current_user %>
      <% user_stock_reservation_count += 1 %>
      <% empty_stock = stock %>
      <% break %>
      <% else if func_book.reservation_users.include?(:current_user) %>
        <% user_book_reservation_count += 1 %>
        <% break %>
        <% else if stock.borrowing || stock.stock_reservation %>
          <% stock_count += 1 %>
        <% else %>
          <% empty_stock = stock %>
          <% break %>
        <% end %>
      <% end %>
    <% end %>
  <% end %>
<% end %>

<br>
<% if user_borrowing_count == 1 %>
  返却期限:
  <% else if user_stock_reservation_count == 1 %>
    取り置き有効期限:<%= empty_stock.stock_reservation.invalid_at %>
  <%= link_to "予約取り消し", users_book_stock_stock_reservation_path(func_book.id, empty_stock.id, empty_stock.stock_reservation.id), method: :delete, data: {confirm: "Are you sure??"} %>
  <% else if user_book_reservation_count == 1 %>
    <%= link_to "予約取り消し", users_book_book_reservation_path(func_book.id), method: :delete, data: {confirm: "Are you sure??"} %>
  <% else %>
    <% if stock_count == func_stocks.count %>
      <%= form_for func_book_reservation, url: users_book_book_reservations_path(func_book.id) do |f| %>
        <%= f.submit :この本を予約する %>
      <% end %>
    <% else %>
      <%= form_for func_stock_reservation, url: users_book_stock_stock_reservations_path(func_book.id, empty_stock.id) do |f| %>
        <%= f.submit :この本を予約する %>
      <% end %>
    <% end %>
  <% end %>
<% end %>

end
